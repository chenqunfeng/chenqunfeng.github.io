var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,o){function a(t){try{h(r.next(t))}catch(e){o(e)}}function s(t){try{h(r["throw"](t))}catch(e){o(e)}}function h(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(a,s)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){h.label=i[1];break}if(6===i[0]&&h.label<a[1]){h.label=a[1],a=i;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(i);break}a[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,a,s,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(t){function e(){var e=t.call(this)||this;return console.log(e),e.createView(),e}return __extends(e,t),e.prototype.createView=function(){console.log(this),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){var i=parseInt(t/e*100+"");this.textField.text="Loading..."+i+"%"},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var CONFIG={bg:["bg1","bg2","bg3","bg4","bg5"],title:{width:"stageWidth",y:100,size:110,bold:!0,textColor:0,text:[{text:"STICK"},{text:"\n"},{text:"HERO"}]},startBtn:{width:140,height:50,backgroundColor:"0xd44f59",text:"开始游戏"},restartBtn:{width:140,height:50,backgroundColor:"0xd44f59",text:"重新开始"},scoreBar:{width:"stageWidth",y:100,size:80,bold:!0,textColor:16777215},platform:{width:100,height:140,increase:50,fillColor:"0x000000"},stick:{width:5,height:5,increase:2}},Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.config=CONFIG,this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.config,e=t.bg,i=t.title,r=t.startBtn,n=t.platform;this.bg=this.createBg(e),this.title=this.crateTitle(i),this.startBtn=this.createStartBtn(r),this.platform1=this.createPlatform(n);var o=this.platform1.x+this.platform1.width/2,a=this.platform1.y;this.role=this.createRole(o,a),this.startRoleStandAnimation(),this.initSound()},e.prototype.createBg=function(t){var e=this.random(t.length-1)+1,i=this.createBitmapByName(t[e]);return i.height=this.stage.stageHeight,this.addChild(i),i},e.prototype.crateTitle=function(t){var e=this.stage,i=(e.stageWidth,e.stageHeight,t.width),r=t.y,n=t.size,o=t.bold,a=t.textColor,s=t.text,h=new egret.TextField;return h.width=this.stage[i]||i,h.y=r,h.textColor=a,h.size=n,h.bold=o,h.textFlow=s,h.textAlign=egret.HorizontalAlign.CENTER,this.addChild(h),h},e.prototype.createStartBtn=function(t){var e=t.width,i=t.height,r=t.backgroundColor,n=t.text,o=new egret.TextField;return o.width=e,o.height=i,o.x=(this.stage.stageWidth-e)/2,o.y=(this.stage.stageHeight-i)/2,o.background=!0,o.backgroundColor=r,o.text=n,o.textAlign=egret.HorizontalAlign.CENTER,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),this.addChild(o),o},e.prototype.createRestartBtn=function(t){var e=t.width,i=t.height,r=t.backgroundColor,n=t.text,o=new egret.TextField;return o.width=e,o.height=i,o.x=(this.stage.stageWidth-e)/2,o.y=(this.stage.stageHeight-i)/2,o.background=!0,o.backgroundColor=r,o.text=n,o.textAlign=egret.HorizontalAlign.CENTER,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this),this.addChild(o),o},e.prototype.createScoreBar=function(t){var e=this.stage,i=(e.stageWidth,e.stageHeight,t.width),r=t.y,n=t.size,o=t.bold,a=t.textColor,s=(t.text,new egret.TextField);return s.width=this.stage[i]||i,s.y=r,s.textColor=a,s.size=n,s.bold=o,s.text="0",s.textAlign=egret.HorizontalAlign.CENTER,this.addChild(s),s},e.prototype.createPlatform=function(t){var e=t.width,i=t.height,r=(t.fillColor,t.increase),n=this.stage,o=n.stageWidth,a=n.stageHeight,s=this.platform1?e-20*this.random(4):e,h=this.platform1?i+r:i,l=this.platform1?this.platform1.width+this.random(o-this.platform1.width-s-20)+20:(o-s)/2,c=this.platform1?a-h:a-h,g=this.createBitmapByName("platform");return g.width=s,g.height=h,g.x=l,g.y=c,this.addChild(g),g},e.prototype.createRole=function(t,e){var i=this.stage,r=(i.stageWidth,i.stageHeight,this.createBitmapByName("stand1"));return r.x=t-13,r.y=e-28,r.width=26,r.height=28,this.addChild(r),r},e.prototype.startRoleStandAnimation=function(){var t=this;egret.Tween.removeTweens(this.role);var e=-1,i=function(){e++,e>=5&&(e=0),t.role.texture=RES.getRes("stand"+(e+1));var r=egret.Tween.get(t.role);r.wait(160.66),r.call(i,t)};i()},e.prototype.startRoleWaitAnimation=function(){var t=this;egret.Tween.removeTweens(this.role);var e=-1,i=function(){e++,e>=6&&(e=0),t.role.texture=RES.getRes("wait"+(e+1));var r=egret.Tween.get(t.role);r.wait(160.66),r.call(i,t)};i()},e.prototype.startRoleKickAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){egret.Tween.removeTweens(t.role);var i=-1,r=function(){if(i++,i>=4)return void e();t.role.texture=RES.getRes("kick"+(i+1));var n=egret.Tween.get(t.role);n.wait(160.66),n.call(r,t)};r()})]})})},e.prototype.startRoleWalkAnimation=function(){var t=this;egret.Tween.removeTweens(this.role);var e=-1,i=function(){e++,e>=5&&(e=0),t.role.texture=RES.getRes("walk"+(e+1));var r=egret.Tween.get(t.role);r.wait(160.66),r.call(i,t)};i()},e.prototype.startRoleFallAnimation=function(){egret.Tween.removeTweens(this.role),egret.Tween.get(this.role).to({y:this.stage.$stageHeight},500)},e.prototype.createStick=function(t){var e=t.width,i=t.height,r=t.x,n=t.y,o=this.createBitmapByName("stick");return o.width=e,o.height=i,o.x=r,o.y=n,o.rotation=270,this.addChild(o),o},e.prototype.startStickFallAnimation=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){t.stick.y;egret.Tween.get(t.stick).to({rotation:0},500).call(function(){e()})})]})})},e.prototype.initSound=function(){this.scoreMp3=RES.getRes("score_mp3"),this.growMp3=RES.getRes("grow_mp3"),this.kickMp3=RES.getRes("kick_mp3"),this.fallMp3=RES.getRes("fall_mp3"),this.deathMp3=RES.getRes("death_mp3"),this.clickMp3=RES.getRes("click_mp3")},e.prototype.startGame=function(){var t=this;this.clickMp3.play(0,1),this.removeChild(this.title),this.removeChild(this.startBtn),this.score=0,this.scoreBar=this.createScoreBar(this.config.scoreBar);var e=this.config.platform.increase,i=this.platform1.y,r=this.platform1.width,n=this.platform1.height,o=this.role.width,a=this.role.height;egret.Tween.get(this.platform1).to({x:0,y:i-e,height:n+e},500).call(function(){return t.platform2=t.createPlatform(t.config.platform)}),egret.Tween.get(this.role).to({x:r-o-this.config.stick.width,y:i-a-e},500).call(function(){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.stickUp,t),t.addEventListener(egret.TouchEvent.TOUCH_END,t.stickEnd,t)})},e.prototype.stickUp=function(){var t=this;this.walkingFlag||(this.stickInterval=setInterval(function(){var e=t.config.stick,i=e.width,r=e.height,n=e.increase;if(t.stick){if(t.stick.width>=t.stage.stageWidth-t.platform1.width)return;t.stick.width+=n}else{var o=t.platform1.x+t.platform1.width,a=t.platform1.y;t.stick=t.createStick({width:i,height:r,x:o,y:a}),t.startRoleWaitAnimation()}},16),this.growChannel=this.growMp3.play())},e.prototype.stickEnd=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i=this;return __generator(this,function(r){switch(r.label){case 0:return!this.stickInterval||this.walkingFlag?[2]:(this.walkingFlag=!0,clearInterval(this.stickInterval),this.growChannel.stop(),this.kickMp3.play(0,1),[4,this.startRoleKickAnimation()]);case 1:return r.sent(),this.fallMp3.play(0,1),[4,this.startStickFallAnimation()];case 2:return r.sent(),this.startRoleWalkAnimation(),this.stick.width<this.platform2.x-this.platform1.x-this.platform1.width||this.stick.width>this.platform2.x+this.platform2.width-this.platform1.x-this.platform1.width?(e=!1,t=this.role.x+this.stick.width):(e=!0,t=this.platform2.x+this.platform2.width-this.role.width-this.config.stick.width),egret.Tween.get(this.role).to({x:t},5*t).call(function(){e?(i.nextTurn(),i.scoreMp3.play(0,1)):(i.gameOver(),i.deathMp3.play(0,1)),i.walkingFlag=!1}),[2]}})})},e.prototype.gameOver=function(){this.startRoleFallAnimation(),this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.stickUp,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.stickEnd,this),this.createRestartBtn(this.config.restartBtn)},e.prototype.nextTurn=function(){var t=this;this.touchEnabled=!1,this.removeChild(this.platform1),this.removeChild(this.stick),this.score+=1,this.scoreBar.text=this.score+"",this.startRoleStandAnimation(),this.platform1=this.platform2,this.stickInterval=null,this.stick=null;var e=(this.config.platform.increase,this.platform1.y,this.platform1.width),i=this.platform1.height,r=this.role.width;this.role.height;egret.Tween.get(this.platform1).to({x:0,height:i},500).call(function(){return t.platform2=t.createPlatform(t.config.platform)}),egret.Tween.get(this.role).to({x:e-r-this.config.stick.width},500).call(function(){t.touchEnabled=!0})},e.prototype.restartGame=function(){this.clickMp3.play(0,1),this.removeChildren(),this.platform1=null,this.stick=null,this.stickInterval=null,this.createGameScene()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.random=function(t){return 0>=t?0:parseInt(Math.random()*t+"")},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);